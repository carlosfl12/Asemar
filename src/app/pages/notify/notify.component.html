<div class="page">
    <header class="page__header">
        <div class="title">
            <div class="title__icon">📄</div>
            <div>
                <h1>Gestión de Facturas</h1>
            </div>
        </div>
        <button class="btn btn--ghost" (click)="load()">↻ Recargar</button>
    </header>

    <section class="list">
        <h2>Facturas erróneas</h2>
        <!-- <div class="counters">
            <p><strong>Facturas subidas:</strong> {{ totalCounter() }}</p>
            <p><strong>Facturas correctas:</strong> {{ okCounter() }}</p>
        </div> -->

        <div *ngIf="loading()" class="empty">Cargando…</div>
        <div *ngIf="error()" class="empty empty--error">
            {{ error() }}
            <button class="btn btn--link" (click)="load()">Reintentar</button>
        </div>

        <ng-container *ngIf="!loading() && !error() && invoices().length === 0">
            <div class="empty">Aún no hay facturas.</div>
        </ng-container>

        <div class="card" *ngFor="let inv of invoices()">
            <div class="card__left">
                <div class="dot dot--error" *ngIf="inv.status === 'err'"></div>
                <div class="dot dot--ok" *ngIf="inv.status === 'ok'"></div>
                <strong class="filename">{{ inv.fileName }}</strong>
                <small class="meta">{{ inv.createdAt | date:'dd/MM/yyyy, HH:mm' }}</small>
            </div>

            <div class="card__right">
                <span class="badge" [ngClass]="badgeClass(inv.status)">
                    {{ inv.status === 'err' ? 'Fallido' : (inv.status === 'ok' ? 'Procesado' : 'Pendiente') }}
                </span>
                <button class="btn btn--ghost" (click)="open(inv)">
                    ✏️ Corregir
                </button>
            </div>
        </div>
    </section>

    <!-- Modal visualizador (overlay) -->
    <app-invoice-visualizer *ngIf="selected() as sel" [invoice]="sel" (close)="closeModal()" (fixed)="onInvoiceFixed()">
    </app-invoice-visualizer>
</div>