<div class="container">
    <h1>Server-Sent Events - Modo Escucha Continua</h1>

    <div class="controls">
        <button (click)="toggleConnection()" [class.btn-danger]="isConnected" [class.btn-primary]="!isConnected"
            class="btn">
            {{ isConnected ? 'Desconectar' : 'Conectar' }}
        </button>
        <button (click)="clearLogs()" class="btn btn-secondary">
            Limpiar Logs
        </button>
        <button (click)="simulateEvent()" [disabled]="!isConnected" class="btn btn-success">
            Simular Evento (Test)
        </button>
    </div>

    <div class="status-container">
        <div class="status" [class.connected]="isConnected" [class.disconnected]="!isConnected">
            <span class="status-icon">{{ isConnected ? 'üü¢' : 'üî¥' }}</span>
            Estado: {{ isConnected ? 'Conectado - Esperando eventos...' : 'Desconectado' }}
        </div>
        <div class="stats">
            <span>Total eventos: <strong>{{ eventLogs.length }}</strong></span>
            <span *ngIf="lastEvent">√öltimo: {{ lastEvent.time }}</span>
        </div>
    </div>

    <div class="data-display">
        <div class="card highlight">
            <h3>üì® √öltimo Evento Recibido</h3>
            <div *ngIf="lastEvent" class="event-data">
                <div class="data-row">
                    <span class="label">ID:</span>
                    <span class="value">{{ lastEvent.id }}</span>
                </div>
                <div class="data-row">
                    <span class="label">Tipo:</span>
                    <span class="value badge">{{ lastEvent.event }}</span>
                </div>
                <div class="data-row">
                    <span class="label">Fecha/Hora:</span>
                    <span class="value">{{ lastEvent.data.datetime }}</span>
                </div>
                <div class="data-row">
                    <span class="label">Mensaje:</span>
                    <span class="value">{{ lastEvent.data.message }}</span>
                </div>
                <div class="data-row">
                    <span class="label">Valor Random:</span>
                    <span class="value">{{ lastEvent.data.randomValue }}</span>
                </div>
            </div>
            <div *ngIf="!lastEvent" class="no-data">
                <p>‚è≥ Esperando el primer evento...</p>
                <p class="hint">Los eventos aparecer√°n aqu√≠ autom√°ticamente cuando se env√≠en desde el servidor</p>
            </div>
        </div>

        <div class="card">
            <h3>üìä Estad√≠sticas</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number">{{ eventLogs.length }}</div>
                    <div class="stat-label">Total Eventos</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ isConnected ? '‚úì' : '‚úó' }}</div>
                    <div class="stat-label">Conexi√≥n Activa</div>
                </div>
            </div>
        </div>
    </div>

    <div class="logs">
        <h3>üìã Historial de Eventos</h3>
        <div class="log-container">
            <div *ngFor="let log of eventLogs; let i = index" class="log-entry" [class.new-entry]="i === 0">
                <div class="log-header">
                    <span class="log-time">üïê {{ log.time }}</span>
                    <span class="log-event">{{ log.event }}</span>
                    <span class="log-id">ID: {{ log.id }}</span>
                </div>
                <pre class="log-data">{{ log.data | json }}</pre>
            </div>
            <p *ngIf="eventLogs.length === 0" class="no-data">
                No hay eventos registrados todav√≠a.
                <br><br>
                <span class="hint">
                    üí° Tip: Mientras est√©s conectado, cualquier llamada a <code>send-event.php</code>
                    enviar√° un evento que aparecer√° aqu√≠ autom√°ticamente.
                </span>
            </p>
        </div>
    </div>

    <div class="error" *ngIf="error">
        <strong>‚ö† Error:</strong> {{ error }}
    </div>

    <div class="info-box">
        <h4>‚Ñπ C√≥mo funciona:</h4>
        <ol>
            <li>Haz clic en <strong>"Conectar"</strong> para iniciar la escucha de eventos</li>
            <li>El frontend quedar√° esperando eventos continuamente</li>
            <li>Cuando llames a <code>send-event.php</code> desde cualquier lugar, el evento llegar√° autom√°ticamente
            </li>
            <li>Puedes probar con el bot√≥n "Simular Evento" o llamando directamente al PHP</li>
        </ol>
    </div>
</div>